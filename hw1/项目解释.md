# Behavior Cloning é¡¹ç›®è¯¦è§£

## ğŸ¯ é¡¹ç›®ç›®æ ‡

è¿™ä¸ªé¡¹ç›®å®ç°äº† **Behavior Cloning (è¡Œä¸ºå…‹éš†)**ï¼Œä¸€ç§æ¨¡ä»¿å­¦ä¹ ï¼ˆImitation Learningï¼‰æ–¹æ³•ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**é€šè¿‡è§‚å¯Ÿä¸“å®¶çš„è¡Œä¸ºï¼Œå­¦ä¹ å¦‚ä½•æ¨¡ä»¿ä¸“å®¶**ã€‚

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### Behavior Cloning æ˜¯ä»€ä¹ˆï¼Ÿ

Behavior Cloning å°±åƒ"çœ‹åˆ«äººæ€ä¹ˆåšï¼Œç„¶åå­¦ç€åš"ï¼š
- **è¾“å…¥**ï¼šä¸“å®¶çš„è§‚æµ‹-åŠ¨ä½œå¯¹ `(observation, action)`
- **è¾“å‡º**ï¼šä¸€ä¸ªç¥ç»ç½‘ç»œç­–ç•¥ï¼Œèƒ½å¤Ÿæ ¹æ®è§‚æµ‹é¢„æµ‹åŠ¨ä½œ
- **æ–¹æ³•**ï¼šç›‘ç£å­¦ä¹ ï¼ˆSupervised Learningï¼‰

### ä¸ºä»€ä¹ˆéœ€è¦ Behavior Cloningï¼Ÿ

åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œè®¾è®¡å¥–åŠ±å‡½æ•°å¾ˆå›°éš¾ã€‚Behavior Cloning å¯ä»¥ï¼š
- ç›´æ¥ä»ä¸“å®¶æ¼”ç¤ºä¸­å­¦ä¹ ï¼Œæ— éœ€è®¾è®¡å¥–åŠ±å‡½æ•°
- å¿«é€Ÿè·å¾—ä¸€ä¸ªå¯ç”¨çš„ç­–ç•¥
- ä½œä¸ºæ›´å¤æ‚æ–¹æ³•ï¼ˆå¦‚ DAggerï¼‰çš„èµ·ç‚¹

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### 1. **run_hw1.py** - ä¸»å…¥å£è„šæœ¬
```python
# ä½œç”¨ï¼šè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå¯åŠ¨è®­ç»ƒæµç¨‹
# å…³é”®åŠŸèƒ½ï¼š
# - argparseï¼šè§£æå‘½ä»¤è¡Œå‚æ•°ï¼ˆPython æ ‡å‡†åº“ï¼‰
# - åˆ›å»ºæ—¥å¿—ç›®å½•
# - è°ƒç”¨ run_bc() å¯åŠ¨è®­ç»ƒ
```

**Python è¯­æ³•è¦ç‚¹**ï¼š
- `argparse.ArgumentParser()`ï¼šåˆ›å»ºå‚æ•°è§£æå™¨
- `vars(args)`ï¼šå°† argparse çš„ Namespace è½¬ä¸ºå­—å…¸
- `os.path.join()`ï¼šè·¨å¹³å°è·¯å¾„æ‹¼æ¥

### 2. **bc_trainer.py** - è®­ç»ƒå™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

è¿™æ˜¯æ•´ä¸ªé¡¹ç›®çš„"å¤§è„‘"ï¼Œè´Ÿè´£åè°ƒè®­ç»ƒè¿‡ç¨‹ï¼š

#### ä¸»è¦æµç¨‹ï¼š
```
1. åˆå§‹åŒ–ç¯å¢ƒã€Agentã€Logger
2. è®­ç»ƒå¾ªç¯ï¼ˆrun_training_loopï¼‰ï¼š
   a. æ”¶é›†æ•°æ®ï¼ˆcollect_training_trajectoriesï¼‰
   b. è®­ç»ƒ Agentï¼ˆtrain_agentï¼‰
   c. è¯„ä¼°æ€§èƒ½ï¼ˆperform_loggingï¼‰
```

#### å…³é”®å‡½æ•°ï¼š

**`collect_training_trajectories`**ï¼š
- **ç¬¬ä¸€æ¬¡è¿­ä»£**ï¼šä» `.pkl` æ–‡ä»¶åŠ è½½ä¸“å®¶æ•°æ®
- **åç»­è¿­ä»£**ï¼ˆDAggerï¼‰ï¼šç”¨å½“å‰ç­–ç•¥æ”¶é›†æ–°æ•°æ®

**`train_agent`**ï¼š
- ä» replay buffer é‡‡æ ·æ‰¹æ¬¡æ•°æ®
- è°ƒç”¨ `agent.train()` æ›´æ–°ç­–ç•¥
- é‡å¤å¤šæ¬¡ï¼ˆ`num_agent_train_steps_per_iter`ï¼‰

**`perform_logging`**ï¼š
- ç”¨è®­ç»ƒå¥½çš„ç­–ç•¥åœ¨ç¯å¢ƒä¸­è¿è¡Œ
- è®¡ç®—å¹³å‡å›æŠ¥ã€æ ‡å‡†å·®ç­‰æŒ‡æ ‡
- è®°å½•åˆ° TensorBoard

### 3. **bc_agent.py** - Agent å°è£…

```python
class BCAgent:
    - actor: MLPPolicySL  # ç­–ç•¥ç½‘ç»œ
    - replay_buffer: ReplayBuffer  # å­˜å‚¨è®­ç»ƒæ•°æ®
```

**ä½œç”¨**ï¼šå°è£…ç­–ç•¥å’Œç¼“å†²åŒºï¼Œæä¾›ç»Ÿä¸€çš„è®­ç»ƒæ¥å£

### 4. **MLP_policy.py** - ç­–ç•¥ç½‘ç»œï¼ˆç¥ç»ç½‘ç»œï¼‰

è¿™æ˜¯å®é™…å­¦ä¹ çš„æ¨¡å‹ï¼š

#### ç½‘ç»œç»“æ„ï¼š
```
è¾“å…¥ï¼ˆè§‚æµ‹ï¼‰ â†’ å¤šå±‚å…¨è¿æ¥ç½‘ç»œ â†’ è¾“å‡ºï¼ˆåŠ¨ä½œçš„å‡å€¼å’Œæ ‡å‡†å·®ï¼‰
```

#### å…³é”®å‡½æ•°ï¼š

**`forward(observation)`**ï¼š
- è¾“å…¥ï¼šè§‚æµ‹ `(batch_size, obs_dim)`
- è¾“å‡ºï¼šåŠ¨ä½œåˆ†å¸ƒ `Normal(mean, std)`
- ä½¿ç”¨é«˜æ–¯åˆ†å¸ƒå› ä¸ºåŠ¨ä½œæ˜¯è¿ç»­çš„

**`get_action(obs)`**ï¼š
- ä»ç­–ç•¥åˆ†å¸ƒä¸­é‡‡æ ·ä¸€ä¸ªåŠ¨ä½œ
- å¤„ç†å•ä¸ªè§‚æµ‹å’Œæ‰¹é‡è§‚æµ‹ä¸¤ç§æƒ…å†µ

**`update(observations, actions)`**ï¼š
- **æŸå¤±å‡½æ•°**ï¼šè´Ÿå¯¹æ•°ä¼¼ç„¶ï¼ˆNegative Log Likelihoodï¼‰
- **åŸç†**ï¼šè®©ç­–ç•¥é¢„æµ‹çš„åŠ¨ä½œåˆ†å¸ƒå°½å¯èƒ½æ¥è¿‘ä¸“å®¶çš„çœŸå®åŠ¨ä½œ
- **ä¼˜åŒ–**ï¼šAdam ä¼˜åŒ–å™¨

### 5. **utils.py** - å·¥å…·å‡½æ•°

**`sample_trajectory`**ï¼š
- åœ¨ç¯å¢ƒä¸­è¿è¡Œç­–ç•¥ï¼Œæ”¶é›†ä¸€æ¡è½¨è¿¹
- è¿”å›ï¼šè§‚æµ‹ã€åŠ¨ä½œã€å¥–åŠ±åºåˆ—

**`sample_trajectories`**ï¼š
- æ”¶é›†å¤šæ¡è½¨è¿¹ï¼Œç›´åˆ°è¾¾åˆ°æŒ‡å®šçš„æ€»æ­¥æ•°

## ğŸ”„ å®Œæ•´è®­ç»ƒæµç¨‹

```
1. åŠ è½½ä¸“å®¶æ•°æ®
   â†“
2. å°†æ•°æ®å­˜å…¥ Replay Buffer
   â†“
3. ä» Buffer é‡‡æ ·æ‰¹æ¬¡æ•°æ®
   â†“
4. ç”¨ç›‘ç£å­¦ä¹ è®­ç»ƒç­–ç•¥ç½‘ç»œ
   ï¼ˆæœ€å°åŒ–é¢„æµ‹åŠ¨ä½œä¸ä¸“å®¶åŠ¨ä½œçš„å·®å¼‚ï¼‰
   â†“
5. ç”¨è®­ç»ƒå¥½çš„ç­–ç•¥åœ¨ç¯å¢ƒä¸­æµ‹è¯•
   â†“
6. è®°å½•æ€§èƒ½æŒ‡æ ‡
```

## ğŸ“Š å®éªŒç»“æœåˆ†æ

### Ant ç¯å¢ƒç»“æœï¼š
- **BC æ€§èƒ½**ï¼š4644.25 Â± 98.19
- **ä¸“å®¶æ€§èƒ½**ï¼š4713.65 Â± 12.20
- **æ€§èƒ½æ¯”**ï¼š98.5% âœ…ï¼ˆè¿œè¶…30%è¦æ±‚ï¼‰

## ğŸ“ Python æ·±åº¦å­¦ä¹ å¸¸ç”¨è¯­æ³•

### 1. **PyTorch åŸºç¡€**
```python
# å¼ é‡æ“ä½œ
torch.from_numpy(arr)  # NumPy â†’ PyTorch
tensor.to(device)      # ç§»åŠ¨åˆ° GPU
tensor.mean()          # è®¡ç®—å‡å€¼

# ç¥ç»ç½‘ç»œ
nn.Sequential()        # é¡ºåºç½‘ç»œ
nn.Linear(in, out)     # å…¨è¿æ¥å±‚
nn.Parameter()         # å¯å­¦ä¹ å‚æ•°

# ä¼˜åŒ–
optim.Adam(params, lr) # Adam ä¼˜åŒ–å™¨
optimizer.zero_grad()   # æ¸…é›¶æ¢¯åº¦
loss.backward()         # åå‘ä¼ æ’­
optimizer.step()        # æ›´æ–°å‚æ•°
```

### 2. **NumPy æ“ä½œ**
```python
np.array()             # åˆ›å»ºæ•°ç»„
np.concatenate()        # æ‹¼æ¥æ•°ç»„
arr.shape              # è·å–å½¢çŠ¶
arr[None]              # æ·»åŠ  batch ç»´åº¦
arr[0]                 # ç§»é™¤ batch ç»´åº¦
```

### 3. **argparse ä½¿ç”¨**
```python
parser = argparse.ArgumentParser()
parser.add_argument('--name', type=str, required=True)
parser.add_argument('--num', type=int, default=10)
args = parser.parse_args()
# ä½¿ç”¨ï¼šargs.name, args.num
```

## ğŸš€ ä¸‹ä¸€æ­¥

1. âœ… Ant ç¯å¢ƒå®éªŒå®Œæˆï¼ˆè¾¾åˆ°è¦æ±‚ï¼‰
2. â³ è¿è¡Œå¦ä¸€ä¸ªç¯å¢ƒï¼ˆBC æ— æ³•è¾¾åˆ°30%ï¼‰
3. â³ è¶…å‚æ•°å®éªŒ

