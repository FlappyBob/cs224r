# run_hw1.py å‘½ä»¤å‚æ•°è¯¦ç»†è§£æ

## ğŸ“ ç¤ºä¾‹å‘½ä»¤

```bash
python cs224r/scripts/run_hw1.py \
  --expert_policy_file cs224r/policies/experts/Ant.pkl \
  --env_name Ant-v4 \
  --exp_name bc_ant \
  --n_iter 1 \
  --expert_data cs224r/expert_data/expert_data_Ant-v4.pkl \
  --video_log_freq -1 \
  --eval_batch_size 5000
```

## ğŸ”§ å‚æ•°è¯¦è§£

### å¿…éœ€å‚æ•°ï¼ˆRequiredï¼‰

| å‚æ•° | çŸ­å‚æ•° | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|--------|------|------|--------|
| `--expert_policy_file` | `-epf` | str | ä¸“å®¶ç­–ç•¥æ–‡ä»¶è·¯å¾„ï¼ˆç”¨äºè¯„ä¼°å’ŒDAggerï¼‰ | `cs224r/policies/experts/Ant.pkl` |
| `--expert_data` | `-ed` | str | ä¸“å®¶æ•°æ®æ–‡ä»¶è·¯å¾„ï¼ˆè®­ç»ƒç”¨çš„è§‚æµ‹-åŠ¨ä½œå¯¹ï¼‰ | `cs224r/expert_data/expert_data_Ant-v4.pkl` |
| `--env_name` | `-env` | str | ç¯å¢ƒåç§°ï¼ˆå¿…é¡»ä»MJ_ENV_NAMESä¸­é€‰æ‹©ï¼‰ | `Ant-v4`, `Hopper-v4`, `Walker2d-v4`, `HalfCheetah-v4` |
| `--exp_name` | `-exp` | str | å®éªŒåç§°ï¼ˆç”¨äºæ—¥å¿—ç›®å½•å‘½åï¼‰ | `bc_ant` |

### è®­ç»ƒæ§åˆ¶å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--n_iter` | int | 1 | **è®­ç»ƒè¿­ä»£æ¬¡æ•°**ã€‚BCç”¨1æ¬¡ï¼ˆåªè®­ç»ƒä¸€æ¬¡ï¼‰ï¼ŒDAggeréœ€è¦>1 |
| `--do_dagger` | flag | False | æ˜¯å¦ä½¿ç”¨DAggerç®—æ³•ï¼ˆå¦‚æœè®¾ç½®ï¼Œn_iterå¿…é¡»>1ï¼‰ |
| `--num_agent_train_steps_per_iter` | int | 1000 | **æ¯ä¸ªè¿­ä»£ä¸­çš„æ¢¯åº¦æ›´æ–°æ­¥æ•°**ï¼ˆé‡è¦ï¼æ§åˆ¶è®­ç»ƒé‡ï¼‰ |

### æ•°æ®ç›¸å…³å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--batch_size` | int | 1000 | æ¯æ¬¡è¿­ä»£æ”¶é›†çš„è®­ç»ƒæ•°æ®æ­¥æ•°ï¼ˆä¸»è¦ç”¨äºDAggerï¼‰ |
| `--eval_batch_size` | int | 1000 | **è¯„ä¼°æ—¶æ”¶é›†çš„è½¨è¿¹æ€»æ­¥æ•°**ï¼ˆé‡è¦ï¼ç”¨äºè®¡ç®—å‡å€¼å’Œæ ‡å‡†å·®ï¼‰<br/>âš ï¸ åº”è®¾ä¸º `ep_len` çš„å€æ•°ï¼Œä¾‹å¦‚ï¼šep_len=1000ï¼Œeval_batch_size=5000 â†’ çº¦5æ¡è½¨è¿¹ |
| `--train_batch_size` | int | 100 | **æ¯æ¬¡æ¢¯åº¦æ›´æ–°ä½¿ç”¨çš„æ‰¹æ¬¡å¤§å°**ï¼ˆä»replay bufferé‡‡æ ·ï¼‰ |
| `--max_replay_buffer_size` | int | 1000000 | Replay bufferçš„æœ€å¤§å®¹é‡ |

### ç½‘ç»œç»“æ„å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--n_layers` | int | 2 | **ç­–ç•¥ç½‘ç»œçš„å±‚æ•°**ï¼ˆæ·±åº¦ï¼‰ |
| `--size` | int | 64 | **æ¯å±‚çš„ç¥ç»å…ƒæ•°é‡**ï¼ˆå®½åº¦ï¼‰ |
| `--learning_rate` | float | 5e-3 | **å­¦ä¹ ç‡**ï¼ˆä¼˜åŒ–å™¨æ­¥é•¿ï¼‰ |

### ç¯å¢ƒå’Œæ—¥å¿—å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--ep_len` | int | None | æ¯æ¡è½¨è¿¹çš„æœ€å¤§é•¿åº¦ï¼ˆNone=ä½¿ç”¨ç¯å¢ƒé»˜è®¤å€¼ï¼‰ |
| `--video_log_freq` | int | 5 | è§†é¢‘è®°å½•é¢‘ç‡ï¼ˆæ¯Næ¬¡è¿­ä»£è®°å½•ä¸€æ¬¡ï¼‰<br/>**è®¾ç½®ä¸º -1 ç¦ç”¨è§†é¢‘**ï¼ˆè°ƒè¯•æ—¶æ¨èï¼Œæ›´å¿«ï¼‰ |
| `--scalar_log_freq` | int | 1 | æ ‡é‡æŒ‡æ ‡è®°å½•é¢‘ç‡ |
| `--seed` | int | 1 | éšæœºç§å­ï¼ˆç¡®ä¿å¯å¤ç°ï¼‰ |

### GPUç›¸å…³å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--no_gpu` | flag | False | ç¦ç”¨GPUï¼Œä½¿ç”¨CPU |
| `--which_gpu` | int | 0 | ä½¿ç”¨å“ªä¸ªGPUï¼ˆå¦‚æœæœ‰å¤šä¸ªï¼‰ |

### å…¶ä»–å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--save_params` | flag | False | æ˜¯å¦ä¿å­˜æ¨¡å‹å‚æ•°åˆ°ç£ç›˜ |

## ğŸ¯ å…³é”®å‚æ•°è¯´æ˜

### 1. `--n_iter` (è¿­ä»£æ¬¡æ•°)
- **BCï¼ˆBehavior Cloningï¼‰**ï¼šè®¾ç½®ä¸º `1`ï¼ˆåªè®­ç»ƒä¸€æ¬¡ï¼Œä½¿ç”¨ä¸“å®¶æ•°æ®ï¼‰
- **DAgger**ï¼šè®¾ç½®ä¸º `>1`ï¼ˆä¾‹å¦‚ `10`ï¼‰ï¼Œéœ€è¦å¤šæ¬¡è¿­ä»£

### 2. `--eval_batch_size` (è¯„ä¼°æ‰¹æ¬¡å¤§å°)
- **ä½œç”¨**ï¼šæ§åˆ¶è¯„ä¼°æ—¶æ”¶é›†å¤šå°‘æ¡è½¨è¿¹
- **å…¬å¼**ï¼šè½¨è¿¹æ•°é‡ â‰ˆ `eval_batch_size / ep_len`
- **ç¤ºä¾‹**ï¼š
  - `ep_len = 1000`, `eval_batch_size = 5000` â†’ çº¦ 5 æ¡è½¨è¿¹
  - `ep_len = 1000`, `eval_batch_size = 10000` â†’ çº¦ 10 æ¡è½¨è¿¹
- **é‡è¦æ€§**ï¼šåªæœ‰æ”¶é›†å¤šæ¡è½¨è¿¹æ‰èƒ½è®¡ç®—å‡å€¼å’Œæ ‡å‡†å·®ï¼

### 3. `--num_agent_train_steps_per_iter` (è®­ç»ƒæ­¥æ•°)
- **ä½œç”¨**ï¼šæ§åˆ¶è®­ç»ƒçš„å¼ºåº¦ï¼ˆæ¯ä¸ªè¿­ä»£ä¸­æ¢¯åº¦æ›´æ–°çš„æ¬¡æ•°ï¼‰
- **é»˜è®¤å€¼**ï¼š1000 æ­¥
- **è°ƒå‚å»ºè®®**ï¼š
  - å¦‚æœæ€§èƒ½ä¸å¤Ÿï¼šå¢åŠ è¿™ä¸ªå€¼ï¼ˆä¾‹å¦‚ 2000, 5000ï¼‰
  - å¦‚æœè®­ç»ƒæ—¶é—´å¤ªé•¿ï¼šå‡å°‘è¿™ä¸ªå€¼ï¼ˆä¾‹å¦‚ 500ï¼‰

### 4. `--video_log_freq` (è§†é¢‘è®°å½•é¢‘ç‡)
- **è°ƒè¯•é˜¶æ®µ**ï¼šè®¾ç½®ä¸º `-1`ï¼ˆç¦ç”¨è§†é¢‘ï¼ŒåŠ å¿«é€Ÿåº¦ï¼‰
- **æœ€ç»ˆå®éªŒ**ï¼šå¯ä»¥ç§»é™¤è¿™ä¸ªå‚æ•°æˆ–è®¾ç½®ä¸ºæ­£æ•°ï¼ˆä¾‹å¦‚ `1`ï¼‰ï¼Œç”Ÿæˆç­–ç•¥è§†é¢‘

### 5. `--n_layers` å’Œ `--size` (ç½‘ç»œç»“æ„)
- **n_layers**ï¼šç½‘ç»œæ·±åº¦ï¼ˆé€šå¸¸ 2-3 å±‚ï¼‰
- **size**ï¼šæ¯å±‚å®½åº¦ï¼ˆé€šå¸¸ 32-256ï¼‰
- **æƒè¡¡**ï¼šæ›´å¤§çš„ç½‘ç»œå¯èƒ½æ€§èƒ½æ›´å¥½ï¼Œä½†è®­ç»ƒæ›´æ…¢

## ğŸ“Š Problem 1 æ¨èçš„å‘½ä»¤å‚æ•°

### Ant ç¯å¢ƒï¼ˆéœ€è¦è¾¾åˆ°ä¸“å®¶æ€§èƒ½çš„30%ï¼‰
```bash
python cs224r/scripts/run_hw1.py \
  --expert_policy_file cs224r/policies/experts/Ant.pkl \
  --env_name Ant-v4 \
  --exp_name bc_ant \
  --n_iter 1 \
  --expert_data cs224r/expert_data/expert_data_Ant-v4.pkl \
  --video_log_freq -1 \
  --eval_batch_size 5000
```

### å¦ä¸€ä¸ªç¯å¢ƒï¼ˆæ— æ³•è¾¾åˆ°30%ï¼Œå¦‚Hopperï¼‰
```bash
python cs224r/scripts/run_hw1.py \
  --expert_policy_file cs224r/policies/experts/Hopper.pkl \
  --env_name Hopper-v4 \
  --exp_name bc_hopper \
  --n_iter 1 \
  --expert_data cs224r/expert_data/expert_data_Hopper-v4.pkl \
  --video_log_freq -1 \
  --eval_batch_size 5000
```

## ğŸ”¬ Problem 2 è¶…å‚æ•°å®éªŒå»ºè®®

å¯ä»¥é€‰æ‹©ä»¥ä¸‹è¶…å‚æ•°è¿›è¡Œå®éªŒï¼š

1. **è®­ç»ƒæ­¥æ•°** (`--num_agent_train_steps_per_iter`)
   - æµ‹è¯•å€¼ï¼š500, 1000, 2000, 5000
   - ç†ç”±ï¼šæ§åˆ¶è®­ç»ƒå¼ºåº¦ï¼Œå½±å“æ¨¡å‹å­¦ä¹ ç¨‹åº¦

2. **ç½‘ç»œå¤§å°** (`--size` æˆ– `--n_layers`)
   - æµ‹è¯•å€¼ï¼š32, 64, 128, 256 (size) æˆ– 1, 2, 3 (layers)
   - ç†ç”±ï¼šå½±å“æ¨¡å‹å®¹é‡ï¼Œå½±å“è¡¨è¾¾èƒ½åŠ›

3. **å­¦ä¹ ç‡** (`--learning_rate`)
   - æµ‹è¯•å€¼ï¼š1e-3, 5e-3, 1e-2, 5e-2
   - ç†ç”±ï¼šå½±å“ä¼˜åŒ–é€Ÿåº¦å’Œç¨³å®šæ€§

## ğŸ’¡ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆ eval_batch_size è¦å¤§äº ep_lenï¼Ÿ**
A: å› ä¸ºéœ€è¦æ”¶é›†å¤šæ¡å®Œæ•´è½¨è¿¹æ‰èƒ½è®¡ç®—å‡å€¼å’Œæ ‡å‡†å·®ã€‚å¦‚æœ eval_batch_size < ep_lenï¼Œå¯èƒ½åªæ”¶é›†åˆ°éƒ¨åˆ†è½¨è¿¹ï¼Œç»Ÿè®¡ä¸å‡†ç¡®ã€‚

**Q: BC å’Œ DAgger çš„åŒºåˆ«ï¼Ÿ**
A: 
- BC: `--n_iter 1`ï¼Œåªä½¿ç”¨ä¸“å®¶æ•°æ®è®­ç»ƒä¸€æ¬¡
- DAgger: `--n_iter > 1 --do_dagger`ï¼Œè¿­ä»£åœ°æ”¶é›†æ•°æ®å¹¶é‡æ–°æ ‡æ³¨

**Q: å¦‚ä½•æŸ¥çœ‹å®éªŒç»“æœï¼Ÿ**
A: ä½¿ç”¨ TensorBoardï¼š
```bash
tensorboard --logdir data
```
ç»“æœä¿å­˜åœ¨ `data/q1_<exp_name>_<env_name>_<timestamp>/` ç›®å½•ä¸‹ã€‚

